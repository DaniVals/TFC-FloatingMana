<!DOCTYPE html>
<html lang="en">
<head>
	{% set meta_title = "Perfil" %}
	{% set meta_description = "Gestiona tu perfil" %}
	
	{% include "root.html.twig" %}
	<link rel="stylesheet" href=" {{ asset('styles/form.css') }} ">

</head>

{% include "header.html.twig" %}
{% block title %}Mi Perfil{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <h1>Mi Perfil</h1>
            
            {# Mostrar mensajes flash #}
            {% for flash_error in app.flashes('error') %}
                <div class="alert alert-danger">{{ flash_error }}</div>
            {% endfor %}
            
            {% for flash_success in app.flashes('success') %}
                <div class="alert alert-success">{{ flash_success }}</div>
            {% endfor %}

            {# Foto de perfil #}
            <div class="card mb-4">
                <div class="card-header">
                    <h5>Foto de Perfil</h5>
                </div>
                <div class="card-body text-center">
                    {% if user.profilePicture %}
                        <img src="{{ '/' ~ user.profilePicture }}" alt="Foto de perfil" class="img-thumbnail mb-3" style="max-width: 200px;">
                        <br>
                        <form method="post" action="{{ path('profile_remove_picture') }}" style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-sm">Eliminar foto</button>
                        </form>
                    {% else %}
                        <div class="mb-3">
                            <i class="fas fa-user-circle fa-5x text-muted"></i>
                            <p class="mt-2">No tienes foto de perfil</p>
                        </div>
                    {% endif %}
                    
                    <form method="post" action="{{ path('profile_upload_picture') }}" enctype="multipart/form-data" class="mt-3">
                        <div class="mb-3">
                            <input type="file" class="form-control" name="profile_picture" accept="image/*" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Subir nueva foto</button>
                    </form>
                </div>
            </div>

            {# Datos básicos del perfil #}
            <div class="card mb-4">
                <div class="card-header">
                    <h5>Información Personal</h5>
                </div>
                <div class="card-body">
                    <form method="post" action="{{ path('profile_update') }}">
                        <div class="mb-3">
                            <label for="name" class="form-label">Nombre</label>
                            <input type="text" class="form-control" id="name" name="name" value="{{ user.name }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Actualizar Perfil</button>
                    </form>
                </div>
            </div>

            {# Cambiar contraseña #}
            <div class="card mb-4">
                <div class="card-header">
                    <h5>Cambiar Contraseña</h5>
                </div>
                <div class="card-body">
                    <form method="post" action="{{ path('profile_change_password') }}">
                        <div class="mb-3">
                            <label for="current_password" class="form-label">Contraseña Actual</label>
                            <input type="password" class="form-control" id="current_password" name="current_password" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="new_password" class="form-label">Nueva Contraseña</label>
                            <input type="password" class="form-control" id="new_password" name="new_password" required minlength="6">
                        </div>
                        
                        <div class="mb-3">
                            <label for="confirm_password" class="form-label">Confirmar Nueva Contraseña</label>
                            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required minlength="6">
                        </div>
                        
                        <button type="submit" class="btn btn-warning">Cambiar Contraseña</button>
                    </form>
                </div>
            </div>

            {# Eliminar cuenta #}
            <div class="card border-danger mb-4">
                <div class="card-header bg-danger text-white">
                    <h5>Zona de Peligro</h5>
                </div>
                <div class="card-body">
                    <p class="text-danger">
                        <strong>¡Atención!</strong> Esta acción eliminará permanentemente tu cuenta y todos tus datos.
                    </p>
                    
                    <form method="post" action="{{ path('profile_delete') }}" onsubmit="return confirm('¿Estás seguro de que quieres eliminar tu cuenta? Esta acción no se puede deshacer.');">
                        <div class="mb-3">
                            <label for="password" class="form-label">Confirma tu contraseña para eliminar la cuenta</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                        </div>
                        
                        <button type="submit" class="btn btn-danger">Eliminar Cuenta</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
